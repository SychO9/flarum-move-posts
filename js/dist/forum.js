(()=>{var t={n:o=>{var s=o&&o.__esModule?()=>o.default:()=>o;return t.d(s,{a:s}),s},d:(o,s)=>{for(var e in s)t.o(s,e)&&!t.o(o,e)&&Object.defineProperty(o,e,{enumerable:!0,get:s[e]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o)};(()=>{"use strict";const o=flarum.core.compat["common/extend"],s=flarum.core.compat["forum/app"];var e=t.n(s);const n=flarum.core.compat["common/components/Button"];var r=t.n(n);const a=flarum.core.compat["common/components/Badge"];var i=t.n(a);const c=flarum.core.compat["forum/components/Post"];var u=t.n(c);const l=flarum.core.compat["forum/components/CommentPost"];var d=t.n(l);const p=flarum.core.compat["forum/components/DiscussionPage"];var f=t.n(p);const v=flarum.core.compat["forum/utils/PostControls"];var h=t.n(v);const y=flarum.core.compat["common/helpers/icon"];var g=t.n(y);const _=flarum.core.compat["common/models/Discussion"];var b=t.n(_);const w=flarum.core.compat["common/Model"];var P=t.n(w);const D=flarum.core.compat["common/utils/Stream"];var M=t.n(D),T=function(){function t(){this.selectedPostsToMove=void 0,this.selectedPostsToMove=M()([])}var o=t.prototype;return o.push=function(t){this.selectedPostsToMove([].concat(this.selectedPostsToMove(),[t]))},o.remove=function(t){this.selectedPostsToMove(this.selectedPostsToMove().filter((function(o){return o!==t})))},o.has=function(t){return this.selectedPostsToMove().includes(t)},t}();function N(t,o){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},N(t,o)}function x(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,N(t,o)}const I=flarum.core.compat["common/components/Modal"];var k=t.n(I);const F=flarum.core.compat["common/components/Switch"];var L=t.n(F);const O=flarum.core.compat["uikit/forum/DiscussionSearch"];var B=t.n(O);const C=flarum.core.compat["forum/states/GlobalSearchState"];var S=t.n(C),j=function(t){function o(){for(var o,s=arguments.length,e=new Array(s),n=0;n<s;n++)e[n]=arguments[n];return(o=t.call.apply(t,[this].concat(e))||this).isLoading=!1,o.newDiscussion=!1,o.newDiscussionTitle="",o.targetDiscussionId=null,o.search=new(S()),o}x(o,t);var s=o.prototype;return s.className=function(){return"MovePostsModal"},s.title=function(){return e().translator.trans("sycho-move-posts.forum.modal.title")},s.content=function(){var t=this;return m("div",{className:"Modal-body"},m("form",{className:"Form",onsubmit:this.onsubmit.bind(this)},m("div",{className:"Form-group"},m("label",null,e().translator.trans("sycho-move-posts.forum.modal.selected_posts",{count:this.attrs.postIds.length})),m("input",{className:"FormControl",readonly:!0,value:this.attrs.postIds.join(", ")})),m("div",{className:"Form-group"},m(L(),{state:this.newDiscussion,onchange:function(){return t.newDiscussion=!t.newDiscussion}},e().translator.trans("sycho-move-posts.forum.modal.new_discussion"))),this.newDiscussion?m("div",{className:"Form-group"},m("label",{for:"discussion_name"},e().translator.trans("sycho-move-posts.forum.modal.discussion_name")),m("p",{className:"helptext"},e().translator.trans("sycho-move-posts.forum.modal.discussion_help")),m("input",{id:"discussion_name",className:"FormControl",required:!0,oninput:function(o){return t.newDiscussionTitle=o.target.value}})):m("div",{className:"Form-group"},m("label",{for:"destination"},e().translator.trans("sycho-move-posts.forum.modal.destination")),m(B(),{state:this.search,ignore:this.attrs.discussion.id(),onSelect:function(o){return t.targetDiscussionId=o.id()}})),m("div",{className:"Form-group Form-controls"},m(r(),{className:"Button Button--primary",type:"submit",loading:"submit"===this.isLoading,disabled:"check"===this.isLoading||!this.targetDiscussionId&&!this.newDiscussionTitle},e().translator.trans("sycho-move-posts.forum.modal.submit")),m(r(),{className:"Button",onclick:this.emulate.bind(this),loading:"check"===this.isLoading,disabled:"submit"===this.isLoading||!this.targetDiscussionId&&!this.newDiscussionTitle},e().translator.trans("sycho-move-posts.forum.modal.check")))))},s.data=function(){var t={sourceDiscussionId:this.attrs.discussion.id(),postIds:this.attrs.postIds};return this.newDiscussion?(t.newDiscussion=!0,t.newDiscussionTitle=this.newDiscussionTitle):t.targetDiscussionId=this.targetDiscussionId,t},s.emulate=function(){var t=this;this.onsubmit(null,!0).then((function(o){switch(o.data.attributes.status){case"old_to_new_move":t.alertAttrs={type:"error",content:e().translator.trans("sycho-move-posts.forum.modal.status.old_to_new_move")};break;case"simple_move":t.alertAttrs={type:"success",content:e().translator.trans("sycho-move-posts.forum.modal.status.simple_move")};break;case"complex_move":t.alertAttrs={type:"warning",content:e().translator.trans("sycho-move-posts.forum.modal.status.complex_move")}}m.redraw()}))},s.onsubmit=function(t,o){var s=this;t&&t.preventDefault(),this.isLoading=o?"check":"submit";var n="/api/posts/move";return o&&(n+="/check"),e().request({method:"POST",url:""+e().forum.attribute("baseUrl")+n,body:{data:this.data()},errorHandler:function(t){var o=t.response.errors[0];if(s.isLoading=!1,"move_old_post_to_newer_discussion"!==o.code)throw t;s.alertAttrs={type:"error",content:e().translator.trans("sycho-move-posts.forum.error.move_old_post_to_newer_discussion")},m.redraw()}}).then((function(t){return s.isLoading=!1,o||(m.redraw(),window.location.reload(),e().modal.close()),t}))},o}(k());const A=flarum.core.compat["forum/components/EventPost"];var q=t.n(A);const E=flarum.core.compat["common/components/Link"];var z=t.n(E),G=function(t){function o(){return t.apply(this,arguments)||this}x(o,t);var s=o.prototype;return s.icon=function(){return"fas fa-exchange-alt"},s.descriptionKey=function(){return"sycho-move-posts.forum.post_stream.post_moved"},s.descriptionData=function(){var t=this.attrs.post.content();return{target_discussion:m(z(),{className:"EventPost-PostMoved-target",href:app.route("discussion.near",{id:t.targetDiscussionId,near:t.number})},t.targetDiscussionTitle),count:t.count}},o}(q());const H=flarum.core.compat["forum/components/Notification"];var K=function(t){function o(){return t.apply(this,arguments)||this}x(o,t);var s=o.prototype;return s.icon=function(){return"fas fa-exchange-alt"},s.href=function(){return app.route("discussion",{id:this.attrs.notification.content().targetDiscussionId})},s.content=function(){return app.translator.trans("sycho-move-posts.forum.notifications.post_moved_text",{targetDiscussionTitle:m("span",{className:"MovePosts-Notification-targetDiscussion"},this.attrs.notification.content().targetDiscussionTitle)})},o}(t.n(H)());e().initializers.add("sycho/flarum-move-posts",(function(){if(b().prototype.isFirstMoved=P().attribute("isFirstMoved"),(0,o.extend)(b().prototype,"badges",(function(t){this.isFirstMoved()&&t.add("firstMoved",m(i(),{type:"firstPostMoved",label:e().translator.trans("sycho-move-posts.forum.badge.first_moved_tooltip"),icon:"fas fa-exchange-alt"}),-20)})),e().postComponents.postMoved=G,e().notificationComponents.postMoved=K,e().data.resources[0].attributes.canMovePosts){var t=new T;(0,o.extend)(d().prototype,"oninit",(function(){this.subtree.check((function(){return t.selectedPostsToMove()}))})),(0,o.extend)(u().prototype,"classes",(function(o){"comment"===this.attrs.post.contentType()&&t.has(this.attrs.post.id())&&o.push("Post--moving")})),(0,o.extend)(d().prototype,"headerItems",(function(o){t.has(this.attrs.post.id())&&o.add("moving",m("span",{className:"PostMoving"},g()("fas fa-exchange-alt")," ",e().translator.trans("sycho-move-posts.forum.post.moving")))})),(0,o.extend)(f().prototype,"oncreate",(function(){t.selectedPostsToMove([])})),(0,o.extend)(f().prototype,"sidebarItems",(function(o){var s=this;t.selectedPostsToMove().length&&o.add("movePosts",m(r(),{icon:"fas fa-exchange-alt",className:"Button",onclick:function(){return e().modal.show(j,{postIds:t.selectedPostsToMove(),discussion:s.discussion})}},e().translator.trans("sycho-move-posts.forum.discussion.move_posts"),m("span",{className:"MovePosts-Button-count"},t.selectedPostsToMove().length)))})),(0,o.extend)(h(),"moderationControls",(function(o,s){if("comment"===s.contentType()){var n=t.has(s.id())?"unmove":"move";o.add("movePost",m(r(),{icon:"fas fa-arrow-right",onclick:function(){"move"===n?t.push(s.id()):t.remove(s.id()),m.redraw()}},e().translator.trans("sycho-move-posts.forum.post."+n)))}}))}}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map